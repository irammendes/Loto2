<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Inteligente Lotofácil - Estratégias Avançadas</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        h1 {
            color: #1a5276;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .number-ball {
            display: inline-block;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #e74c3c;
            color: white;
            text-align: center;
            line-height: 32px;
            margin: 3px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .number-ball:hover {
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
        }
        .number-ball.recent {
            background-color: #27ae60;
        }
        .number-ball.cold {
            background-color: #2980b9;
        }
        .number-ball.fixed {
            background-color: #8e44ad;
        }
        .number-ball.excluded {
            background-color: #7f8c8d;
            text-decoration: line-through;
        }
        .number-ball.not-drawn {
            background-color: #f39c12;
        }
        .number-ball.prime {
            background-color: #16a085;
        }
        .number-ball.extreme {
            background-color: #c0392b;
        }
        .number-ball.not-drawn-last {
            background-color: #d35400;
        }
        .game-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        .control-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .strategy-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.secondary {
            background-color: #2ecc71;
        }
        button.secondary:hover {
            background-color: #27ae60;
        }
        button.tertiary {
            background-color: #f39c12;
        }
        button.tertiary:hover {
            background-color: #e67e22;
        }
        .generated-games {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        .game {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .game-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .game-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .game-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #e74c3c;
            color: white;
            text-align: center;
            line-height: 28px;
            font-size: 13px;
            font-weight: bold;
        }
        .fixed-number {
            background-color: #8e44ad;
        }
        .not-drawn-number {
            background-color: #f39c12;
        }
        .not-drawn-last-number {
            background-color: #d35400;
        }
        .prime-number {
            background-color: #16a085;
        }
        .extreme-number {
            background-color: #c0392b;
        }
        .info-section {
            background-color: #eaf2f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }
        .number-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .number-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .number-group-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .last-draws {
            margin-top: 30px;
        }
        .draw {
            background-color: #f8f9fa;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .draw-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .draw-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .draw-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #e74c3c;
            color: white;
            text-align: center;
            line-height: 28px;
            font-size: 13px;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .stats-table th, .stats-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .stats-table th {
            background-color: #2c3e50;
            color: white;
        }
        .stats-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .strategy-options {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .strategy-options h3 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .strategy-options div {
            margin: 12px 0;
        }
        .strategy-options input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .strategy-options label {
            font-weight: 500;
            cursor: pointer;
        }
        .highlight {
            background-color: #fffde7;
        }
        .prime-explanation {
            font-size: 14px;
            color: #555;
            margin-top: 5px;
        }
        .game-report {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            border-left: 3px solid #3498db;
        }
        .report-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .report-item {
            margin: 3px 0;
            display: flex;
            justify-content: space-between;
        }
        .report-good {
            color: #27ae60;
        }
        .report-bad {
            color: #e74c3c;
        }
        .report-neutral {
            color: #f39c12;
        }
        .report-strategy {
            font-weight: 500;
        }
        .report-details {
            margin-top: 8px;
            font-size: 13px;
            color: #555;
        }
        .strategy-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 5px;
        }
        .tag-balanced {
            background-color: #d5f5e3;
            color: #27ae60;
        }
        .tag-primes {
            background-color: #d1f2eb;
            color: #16a085;
        }
        .tag-extremes {
            background-color: #fadbd8;
            color: #c0392b;
        }
        .tag-unique {
            background-color: #eaf2f8;
            color: #2980b9;
        }
        .rating-stars {
            color: #f39c12;
            font-weight: bold;
        }
        .cycle-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerador Inteligente de Jogos Lotofácil</h1>
        
        <div class="info-section">
            <h2>Estratégias Avançadas</h2>
            <p>Este gerador utiliza técnicas estatísticas para aumentar suas chances na Lotofácil:</p>
            <ul>
                <li><strong>Evitar combinações já sorteadas</strong> - Elimina jogos que já foram premiados</li>
                <li><strong>Balancear pares/ímpares</strong> - Proporção ideal de 7-8 ou 8-7</li>
                <li><strong>Dobrar premiação</strong> - Gera jogos com 16-17 números para múltiplos acertos</li>
                <li><strong>Atenção às bolas 1 e 15</strong> - Foco nos números extremos dos sorteios</li>
                <li><strong>Números primos</strong> - Prioriza números primos (2,3,5,7,11,13,17,19,23)</li>
                <li><strong>Ciclo de dezenas não sorteadas</strong> - Identifica números que não apareceram nos últimos concursos</li>
            </ul>
            <button id="load-results">Atualizar Dados <span id="loading-spinner" class="loading" style="display: none;"></span></button>
            <div id="api-status" style="margin-top: 12px; font-style: italic; color: #555;"></div>
        </div>
        
        <div id="last-results" class="last-draws" style="display: none;">
            <h2>Últimos 10 Sorteios</h2>
            <div id="draws-container"></div>
            
            <h2>Estatísticas Detalhadas</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Número</th>
                        <th>Frequência</th>
                        <th>Último Sorteio</th>
                        <th>Atraso</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody id="stats-body">
                </tbody>
            </table>
        </div>
        
        <div class="analysis-section">
            <h2>Configurações do Gerador</h2>
            
            <div class="strategy-options">
                <h3>Estratégias Avançadas</h3>
                <div>
                    <input type="checkbox" id="avoid-repeated" checked>
                    <label for="avoid-repeated">Evitar combinações já sorteadas</label>
                </div>
                <div>
                    <input type="checkbox" id="balance-parity" checked>
                    <label for="balance-parity">Balancear pares e ímpares (7-8 ou 8-7)</label>
                </div>
                <div>
                    <input type="checkbox" id="use-primes" checked>
                    <label for="use-primes">Usar números primos (2,3,5,7,11,13,17,19,23)</label>
                    <div class="prime-explanation">Números primos aparecem em ~70% dos sorteios</div>
                </div>
                <div>
                    <input type="checkbox" id="double-premium">
                    <label for="double-premium">Dobrar premiação (gerar com 16-17 números)</label>
                </div>
                <div>
                    <input type="checkbox" id="watch-extremes" checked>
                    <label for="watch-extremes">Atentar para números extremos (bolas 1 e 15)</label>
                </div>
                <div>
                    <input type="checkbox" id="use-not-drawn-cycle" checked>
                    <label for="use-not-drawn-cycle">Usar ciclo de dezenas não sorteadas</label>
                </div>
            </div>
            
            <div class="game-controls">
                <div class="control-group">
                    <h3>Números Fixos (Máx. 15)</h3>
                    <div id="fixed-numbers-container"></div>
                </div>
                
                <div class="control-group">
                    <h3>Números para Excluir</h3>
                    <div id="excluded-numbers-container"></div>
                </div>
                
                <div class="control-group">
                    <h3>Opções de Geração</h3>
                    <label for="game-count">Quantidade de jogos:</label>
                    <input type="number" id="game-count" min="1" max="20" value="5" style="padding: 8px; width: 60px;">
                    
                    <div class="strategy-buttons">
                        <button id="generate-games" class="secondary">Gerar Jogos Inteligentes</button>
                        <button id="generate-cold" class="tertiary">Focar em Números Atrasados</button>
                        <button id="generate-not-drawn" class="tertiary">Usar Números Não Sorteados</button>
                        <button id="generate-not-drawn-cycle" class="tertiary">Usar Ciclo de Não Sorteados</button>
                        <button id="generate-balanced">Jogo Balanceado</button>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button id="clear-selections">Limpar Seleções</button>
                        <button id="save-games" style="margin-left: 10px;">Salvar Jogos</button>
                    </div>
                </div>
            </div>
            
            <div class="number-groups">
                <div class="number-group">
                    <div class="number-group-title">Números Quentes (8+ sorteios)</div>
                    <div id="recent-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Frios (3 ou menos)</div>
                    <div id="cold-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Não Sorteados (últimos 5)</div>
                    <div id="not-drawn-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Não Sorteados (último sorteio)</div>
                    <div id="not-drawn-last-numbers"></div>
                    <div id="cycle-info" class="cycle-info"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Primos</div>
                    <div id="prime-numbers"></div>
                </div>
            </div>
            
            <h2>Jogos Gerados</h2>
            <div id="generated-games" class="generated-games"></div>
        </div>
    </div>

    <script>
        // Constantes e configurações
        const PRIME_NUMBERS = [2, 3, 5, 7, 11, 13, 17, 19, 23];
        const MAX_ATTEMPTS = 500;
        
        // Dados globais
        let frequencyData = {};
        let notDrawnNumbers = [];
        let notDrawnLastNumbers = [];
        let lastDraws = [];
        let numberStats = {};
        let fixedNumbers = [];
        let excludedNumbers = [];
        let notDrawnCycleInfo = {};
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Carrega dados salvos localmente
            const savedData = localStorage.getItem('lotofacilData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.lastDraws?.length > 0) {
                        processResults(parsedData);
                        document.getElementById('api-status').textContent = 
                            `Dados carregados do cache (${new Date(parsedData.timestamp).toLocaleString()})`;
                        document.getElementById('last-results').style.display = 'block';
                    }
                } catch (e) {
                    console.error("Erro ao carregar dados salvos:", e);
                }
            }
            
            // Configura event listeners
            setupEventListeners();
            
            // Se não há dados, carrega fallback
            if (lastDraws.length === 0) {
                loadFallbackData();
            }
        });

        // Configura os listeners de eventos
        function setupEventListeners() {
            document.getElementById('load-results').addEventListener('click', loadResults);
            document.getElementById('generate-games').addEventListener('click', generateGames);
            document.getElementById('generate-cold').addEventListener('click', generateColdGames);
            document.getElementById('generate-not-drawn').addEventListener('click', generateNotDrawnGames);
            document.getElementById('generate-not-drawn-cycle').addEventListener('click', generateNotDrawnCycleGames);
            document.getElementById('generate-balanced').addEventListener('click', generateBalancedGames);
            document.getElementById('clear-selections').addEventListener('click', clearSelections);
            document.getElementById('save-games').addEventListener('click', saveGames);
        }

        // Carrega resultados da API oficial da Caixa
        async function loadResults() {
            const loadingSpinner = document.getElementById('loading-spinner');
            const loadResultsBtn = document.getElementById('load-results');
            const apiStatus = document.getElementById('api-status');
            
            try {
                loadingSpinner.style.display = 'inline-block';
                loadResultsBtn.disabled = true;
                apiStatus.textContent = 'Conectando à API da Caixa...';
                
                // Endpoint oficial da Caixa Econômica Federal
                const response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil');
                
                if (!response.ok) throw new Error('Erro na API da Caixa');
                
                const data = await response.json();
                
                // Processa os dados da API oficial
                const processedData = {
                    numero: data.numero,
                    data: data.dataApuracao,
                    listaDezenas: data.listaDezenas.map(Number)
                };
                
                
                // Calcula estatísticas
                calculateStatistics();
                
                // Salva localmente para uso futuro
                const saveData = {
                    lastDraws: lastDraws,
                    frequencyData: frequencyData,
                    notDrawnNumbers: notDrawnNumbers,
                    notDrawnLastNumbers: notDrawnLastNumbers,
                    notDrawnCycleInfo: notDrawnCycleInfo,
                    numberStats: numberStats,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('lotofacilData', JSON.stringify(saveData));
                
                // Atualiza a interface
                updateDrawsDisplay();
                updateStatsTable();
                initializeNumbers();
                
                document.getElementById('last-results').style.display = 'block';
                apiStatus.textContent = 'Dados atualizados em ' + new Date().toLocaleString();
                
            } catch (error) {
                console.error('Erro ao acessar API da Caixa:', error);
                apiStatus.textContent = 'Erro ao carregar dados. Usando cache local.';
                
                // Tenta usar dados salvos
                const savedData = localStorage.getItem('lotofacilData');
                if (savedData) {
                    processResults(JSON.parse(savedData));
                    document.getElementById('last-results').style.display = 'block';
                } else {
                    loadFallbackData();
                }
            } finally {
                loadingSpinner.style.display = 'none';
                loadResultsBtn.disabled = false;
            }
        }

            
            // Calcula estatísticas
            calculateStatistics();
            
            // Atualiza a interface
            updateDrawsDisplay();
            updateStatsTable();
            initializeNumbers();
        }
            
            return newDraw.sort((a, b) => a - b);
        }

        // Calcula estatísticas
        function calculateStatistics() {
            frequencyData = {};
            numberStats = {};
            
            // Inicializa contadores
            for (let i = 1; i <= 25; i++) {
                frequencyData[i] = 0;
                numberStats[i] = {
                    lastDraw: 0,
                    delay: 10,
                    isPrime: PRIME_NUMBERS.includes(i)
                };
            }
            
            // Conta frequências e atrasos
            lastDraws.forEach((draw, index) => {
                draw.dezenas.forEach(num => {
                    frequencyData[num]++;
                    numberStats[num].lastDraw = 10 - index;
                    numberStats[num].delay = 0;
                });
            });
            
            // Calcula atrasos para números não sorteados
            for (let num = 1; num <= 25; num++) {
                if (numberStats[num].delay === 0) continue;
                
                let delay = 10;
                for (let i = 0; i < lastDraws.length; i++) {
                    if (lastDraws[i].dezenas.includes(num)) {
                        delay = i;
                        break;
                    }
                }
                numberStats[num].delay = delay;
            }
            
            // Identifica números não sorteados nos últimos 5 concursos
            notDrawnNumbers = [];
            const last5Draws = lastDraws.slice(0, 5);
            const drawnInLast5 = new Set();
            
            last5Draws.forEach(draw => {
                draw.dezenas.forEach(num => drawnInLast5.add(num));
            });
            
            for (let i = 1; i <= 25; i++) {
                if (!drawnInLast5.has(i)) {
                    notDrawnNumbers.push(i);
                }
            }
            
            // Identifica números não sorteados no último concurso
            notDrawnLastNumbers = [];
            const lastDrawNumbers = lastDraws[0].dezenas;
            for (let i = 1; i <= 25; i++) {
                if (!lastDrawNumbers.includes(i)) {
                    notDrawnLastNumbers.push(i);
                }
            }
            
            // Calcula ciclos de números não sorteados nos últimos 10 concursos
            calculateNotDrawnCycles();
        }

        // Calcula ciclos de números não sorteados nos últimos 10 concursos
        function calculateNotDrawnCycles() {
            notDrawnCycleInfo = {};
            
            // Verifica se todos os números foram sorteados nos últimos 10 concursos
            const allNumbersDrawn = new Set();
            lastDraws.forEach(draw => {
                draw.dezenas.forEach(num => allNumbersDrawn.add(num));
            });
            
            const allNumbersWereDrawn = allNumbersDrawn.size === 25;
            
            if (allNumbersWereDrawn) {
                // Se todos os números foram sorteados, reinicia o ciclo
                notDrawnCycleInfo.cycleActive = true;
                notDrawnCycleInfo.cycleStart = lastDraws[0].numero;
                notDrawnCycleInfo.numbersNotDrawnInCycle = [];
                
                // Verifica quais números não foram sorteados no último concurso
                notDrawnCycleInfo.numbersNotDrawnInCycle = notDrawnLastNumbers;
            } else {
                // Se não, continua o ciclo atual
                notDrawnCycleInfo.cycleActive = false;
                notDrawnCycleInfo.numbersNotDrawnInCycle = [];
                
                // Identifica números que não foram sorteados nos últimos 10 concursos
                for (let i = 1; i <= 25; i++) {
                    let wasDrawn = false;
                    for (let j = 0; j < lastDraws.length; j++) {
                        if (lastDraws[j].dezenas.includes(i)) {
                            wasDrawn = true;
                            break;
                        }
                    }
                    if (!wasDrawn) {
                        notDrawnCycleInfo.numbersNotDrawnInCycle.push(i);
                    }
                }
            }
            
            // Atualiza a exibição do ciclo
            updateCycleInfoDisplay();
        }

        // Atualiza a exibição das informações do ciclo
        function updateCycleInfoDisplay() {
            const cycleInfoElement = document.getElementById('cycle-info');
            
            if (notDrawnCycleInfo.cycleActive) {
                cycleInfoElement.innerHTML = `
                    <strong>Ciclo Ativo:</strong> Todos os números foram sorteados nos últimos 10 concursos.<br>
                    <strong>Números não sorteados no último concurso:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.join(', ')}<br>
                    <strong>Quantidade:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.length} números
                `;
            } else if (notDrawnCycleInfo.numbersNotDrawnInCycle.length > 0) {
                cycleInfoElement.innerHTML = `
                    <strong>Ciclo Incompleto:</strong> Alguns números não foram sorteados nos últimos 10 concursos.<br>
                    <strong>Números atrasados:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.join(', ')}<br>
                    <strong>Quantidade:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.length} números
                `;
            } else {
                cycleInfoElement.innerHTML = `
                    <strong>Status do Ciclo:</strong> Aguardando todos os números serem sorteados nos últimos 10 concursos.
                `;
            }
        }

        // Atualiza a exibição dos sorteios
        function updateDrawsDisplay() {
            const container = document.getElementById('draws-container');
            container.innerHTML = '';
            
            lastDraws.slice(0, 10).forEach(draw => {
                const drawElement = document.createElement('div');
                drawElement.className = 'draw';
                
                const titleElement = document.createElement('div');
                titleElement.className = 'draw-title';
                titleElement.textContent = `Concurso ${draw.numero} - ${draw.data}`;
                drawElement.appendChild(titleElement);
                
                const numbersElement = document.createElement('div');
                numbersElement.className = 'draw-numbers';
                
                draw.dezenas.forEach(num => {
                    const numElement = document.createElement('div');
                    numElement.className = 'draw-number';
                    
                    // Destaca números extremos
                    if (num === Math.min(...draw.dezenas) || num === Math.max(...draw.dezenas)) {
                        numElement.style.backgroundColor = '#c0392b';
                    } 
                    // Destaca números primos
                    else if (PRIME_NUMBERS.includes(num)) {
                        numElement.style.backgroundColor = '#16a085';
                    }
                    
                    numElement.textContent = num;
                    numbersElement.appendChild(numElement);
                });
                
                drawElement.appendChild(numbersElement);
                container.appendChild(drawElement);
            });
        }

        // Atualiza a tabela de estatísticas
        function updateStatsTable() {
            const tbody = document.getElementById('stats-body');
            tbody.innerHTML = '';
            
            for (let num = 1; num <= 25; num++) {
                const row = document.createElement('tr');
                
                // Destaca linhas com base nas características
                if (numberStats[num].isPrime) {
                    row.classList.add('highlight');
                }
                
                const numCell = document.createElement('td');
                numCell.textContent = num;
                if (numberStats[num].isPrime) {
                    numCell.innerHTML += ' <span style="color:#16a085;">●</span>';
                }
                row.appendChild(numCell);
                
                const freqCell = document.createElement('td');
                freqCell.textContent = frequencyData[num];
                row.appendChild(freqCell);
                
                const lastCell = document.createElement('td');
                lastCell.textContent = numberStats[num].lastDraw || '-';
                row.appendChild(lastCell);
                
                const delayCell = document.createElement('td');
                delayCell.textContent = numberStats[num].delay;
                row.appendChild(delayCell);
                
                const typeCell = document.createElement('td');
                let typeText = '';
                if (numberStats[num].isPrime) typeText += 'Primo, ';
                if (frequencyData[num] >= 8) typeText += 'Quente';
                else if (frequencyData[num] <= 3) typeText += 'Frio';
                else typeText += 'Normal';
                
                typeCell.textContent = typeText;
                row.appendChild(typeCell);
                
                tbody.appendChild(row);
            }
        }

        // Inicializa os números interativos
        function initializeNumbers() {
            const fixedContainer = document.getElementById('fixed-numbers-container');
            const excludedContainer = document.getElementById('excluded-numbers-container');
            const recentContainer = document.getElementById('recent-numbers');
            const coldContainer = document.getElementById('cold-numbers');
            const notDrawnContainer = document.getElementById('not-drawn-numbers');
            const notDrawnLastContainer = document.getElementById('not-drawn-last-numbers');
            const primeContainer = document.getElementById('prime-numbers');
            
            fixedContainer.innerHTML = '';
            excludedContainer.innerHTML = '';
            recentContainer.innerHTML = '';
            coldContainer.innerHTML = '';
            notDrawnContainer.innerHTML = '';
            notDrawnLastContainer.innerHTML = '';
            primeContainer.innerHTML = '';
            
            // Cria todas as bolas de 1 a 25
            for (let i = 1; i <= 25; i++) {
                // Bolas para seleção fixa
                const fixedBall = createNumberBall(i, 'fixed');
                fixedContainer.appendChild(fixedBall);
                
                // Bolas para exclusão
                const excludedBall = createNumberBall(i, 'excluded');
                excludedContainer.appendChild(excludedBall);
            }
            
            // Agrupa números quentes (frequentes)
            const hotNumbers = Object.keys(frequencyData)
                .filter(num => frequencyData[num] >= 8)
                .map(Number);
            
            hotNumbers.forEach(num => {
                const ball = createNumberBall(num, 'recent');
                recentContainer.appendChild(ball);
            });
            
            // Agrupa números frios (raros)
            const coldNumbers = Object.keys(frequencyData)
                .filter(num => frequencyData[num] <= 3)
                .map(Number);
            
            coldNumbers.forEach(num => {
                const ball = createNumberBall(num, 'cold');
                coldContainer.appendChild(ball);
            });
            
            // Agrupa números não sorteados nos últimos 5 concursos
            notDrawnNumbers.forEach(num => {
                const ball = createNumberBall(num, 'not-drawn');
                notDrawnContainer.appendChild(ball);
            });
            
            // Agrupa números não sorteados no último concurso
            notDrawnLastNumbers.forEach(num => {
                const ball = createNumberBall(num, 'not-drawn-last');
                notDrawnLastContainer.appendChild(ball);
            });
            
            // Agrupa números primos
            PRIME_NUMBERS.forEach(num => {
                const ball = createNumberBall(num, 'prime');
                primeContainer.appendChild(ball);
            });
        }

        // Cria uma bola de número interativa
        function createNumberBall(number, type) {
            const ball = document.createElement('span');
            ball.className = 'number-ball';
            ball.textContent = number;
            ball.dataset.number = number;
            
            // Adiciona classes baseadas no tipo
            if (type === 'fixed') {
                if (fixedNumbers.includes(number)) ball.classList.add('fixed');
            } else if (type === 'excluded') {
                if (excludedNumbers.includes(number)) ball.classList.add('excluded');
            } else if (type === 'recent') {
                ball.classList.add('recent');
            } else if (type === 'cold') {
                ball.classList.add('cold');
            } else if (type === 'not-drawn') {
                ball.classList.add('not-drawn');
            } else if (type === 'not-drawn-last') {
                ball.classList.add('not-drawn-last');
            } else if (type === 'prime') {
                ball.classList.add('prime');
            }
            
            // Configura o clique
            ball.addEventListener('click', () => {
                if (type === 'fixed' || type === 'recent' || type === 'cold' || type === 'not-drawn' || type === 'not-drawn-last' || type === 'prime') {
                    toggleFixedNumber(number);
                } else if (type === 'excluded') {
                    toggleExcludedNumber(number);
                }
            });
            
            return ball;
        }

        // Alterna número fixo
        function toggleFixedNumber(number) {
            const index = fixedNumbers.indexOf(number);
            
            if (index === -1) {
                if (fixedNumbers.length < 15) {
                    fixedNumbers.push(number);
                    
                    // Remove dos excluídos se estiver lá
                    const excludedIndex = excludedNumbers.indexOf(number);
                    if (excludedIndex !== -1) {
                        excludedNumbers.splice(excludedIndex, 1);
                    }
                } else {
                    alert('Você só pode selecionar no máximo 15 números fixos!');
                    return;
                }
            } else {
                fixedNumbers.splice(index, 1);
            }
            
            // Atualiza a exibição
            initializeNumbers();
        }

        // Alterna número excluído
        function toggleExcludedNumber(number) {
            const index = excludedNumbers.indexOf(number);
            
            if (index === -1) {
                excludedNumbers.push(number);
                
                // Remove dos fixos se estiver lá
                const fixedIndex = fixedNumbers.indexOf(number);
                if (fixedIndex !== -1) {
                    fixedNumbers.splice(fixedIndex, 1);
                }
            } else {
                excludedNumbers.splice(index, 1);
            }
            
            // Atualiza a exibição
            initializeNumbers();
        }

        // Gera números aleatórios com estratégias
        function generateRandomNumbers(count, exclude = []) {
            const available = [];
            for (let i = 1; i <= 25; i++) {
                if (!exclude.includes(i) && !excludedNumbers.includes(i)) {
                    available.push(i);
                }
            }
            
            if (available.length < count) {
                alert('Não há números suficientes disponíveis com as configurações atuais!');
                return [];
            }
            
            // Embaralha os números disponíveis
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count).sort((a, b) => a - b);
        }

        // Verifica se uma combinação já foi sorteada
        function isRepeatedCombination(numbers) {
            return lastDraws.some(draw => {
                const drawNumbers = draw.dezenas.map(Number);
                return arraysEqual(numbers.sort(), drawNumbers.sort());
            });
        }

        // Compara arrays
        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        // Verifica balanceamento par/ímpar
        function isBalancedParity(numbers) {
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            return Math.abs(evens - odds) <= 1; // Diferença de no máximo 1
        }

        // Verifica números primos
        function hasGoodPrimeCount(numbers) {
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            return primes >= 5 && primes <= 7; // Entre 5 e 7 primos
        }

        // Verifica números extremos
        function hasGoodExtremes(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const first = sorted[0];
            const last = sorted[sorted.length - 1];
            
            // Pelo menos um dos extremos deve ser quente ou primo
            return (
                frequencyData[first] >= 7 || 
                frequencyData[last] >= 7 || 
                PRIME_NUMBERS.includes(first) || 
                PRIME_NUMBERS.includes(last)
            );
        }

        // Verifica se o jogo usa números do ciclo não sorteados
        function usesNotDrawnCycleNumbers(numbers) {
            if (!document.getElementById('use-not-drawn-cycle').checked) return true;
            if (!notDrawnCycleInfo.cycleActive) return true;
            
            // Verifica se pelo menos 2 números não sorteados no último concurso estão no jogo
            const intersection = numbers.filter(num => notDrawnCycleInfo.numbersNotDrawnInCycle.includes(num));
            return intersection.length >= 2;
        }

        // Gera relatório detalhado do jogo
        function generateGameReport(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const firstExtreme = sorted[0];
            const lastExtreme = sorted[sorted.length - 1];
            
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            const primesList = numbers.filter(n => PRIME_NUMBERS.includes(n)).join(', ');
            
            const isBalanced = isBalancedParity(numbers);
            const hasGoodPrimes = hasGoodPrimeCount(numbers);
            const hasGoodExtremesValue = hasGoodExtremes(numbers);
            const isRepeated = isRepeatedCombination(numbers);
            const isDoublePremium = numbers.length > 15;
            const usesCycleNumbers = usesNotDrawnCycleNumbers(numbers);
            
            // Calcula score de qualidade
            let score = 0;
            if (isBalanced) score += 20;
            if (hasGoodPrimes) score += 20;
            if (hasGoodExtremesValue) score += 15;
            if (!isRepeated) score += 25;
            if (usesCycleNumbers) score += 20;
            
            // Classificação
            let rating = "";
            let stars = "";
            if (score >= 90) {
                rating = "Excelente";
                stars = "★★★★★";
            } else if (score >= 75) {
                rating = "Muito Bom";
                stars = "★★★★";
            } else if (score >= 60) {
                rating = "Bom";
                stars = "★★★";
            } else if (score >= 40) {
                rating = "Regular";
                stars = "★★";
            } else {
                rating = "Básico";
                stars = "★";
            }
            
            // Cria o relatório
            const report = document.createElement('div');
            report.className = 'game-report';
            
            report.innerHTML = `
                <div class="report-title">Relatório de Estratégia</div>
                
                <div class="report-item">
                    <span class="report-strategy">Classificação:</span>
                    <strong>${rating} <span class="rating-stars">${stars}</span></strong>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Tipo:</span>
                    <span>${isDoublePremium ? 'Jogo Premium (' + numbers.length + ' números)' : 'Jogo Padrão (15 números)'}</span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Pares/Ímpares:</span>
                    <span class="${isBalanced ? 'report-good' : 'report-bad'}">
                        ${evens} pares | ${odds} ímpares
                        ${isBalanced ? '(Balanceado)' : '(Desequilibrado)'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Números Primos:</span>
                    <span class="${hasGoodPrimes ? 'report-good' : 'report-bad'}">
                        ${primes} primos (${primesList}) ${hasGoodPrimes ? '(Ótimo)' : '(Fora da faixa ideal)'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Extremos (${firstExtreme} e ${lastExtreme}):</span>
                    <span class="${hasGoodExtremesValue ? 'report-good' : 'report-neutral'}">
                        ${hasGoodExtremesValue ? 'Bons números' : 'Pode melhorar'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Combinação única:</span>
                    <span class="${!isRepeated ? 'report-good' : 'report-bad'}">
                        ${!isRepeated ? 'Nunca sorteada' : 'Já sorteada antes'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Ciclo de não sorteados:</span>
                    <span class="${usesCycleNumbers ? 'report-good' : 'report-neutral'}">
                        ${usesCycleNumbers ? 'Usa números do ciclo' : 'Não usa números do ciclo'}
                    </span>
                </div>
                
                <div class="report-details">
                    <div><span class="strategy-tag tag-balanced">Balanceado</span> ${isBalanced ? '✔' : '✖'} Diferença de ${Math.abs(evens - odds)} entre pares/ímpares</div>
                    <div><span class="strategy-tag tag-primes">Primos</span> ${hasGoodPrimes ? '✔' : '✖'} ${primes} números primos (ideal 5-7)</div>
                    <div><span class="strategy-tag tag-extremes">Extremos</span> ${hasGoodExtremesValue ? '✔' : '✖'} ${firstExtreme} (freq. ${frequencyData[firstExtreme]}) e ${lastExtreme} (freq. ${frequencyData[lastExtreme]})</div>
                    <div><span class="strategy-tag tag-unique">Único</span> ${!isRepeated ? '✔' : '✖'} Combinação ${!isRepeated ? 'nunca sorteada' : 'já apareceu antes'}</div>
                    <div><span class="strategy-tag">Ciclo</span> ${usesCycleNumbers ? '✔' : '✖'} ${usesCycleNumbers ? 'Usa ' + numbers.filter(n => notDrawnCycleInfo.numbersNotDrawnInCycle.includes(n)).length + ' números do ciclo' : 'Não usa números do ciclo'}</div>
                </div>
            `;
            
            return report;
        }

        // Gera jogos com números atrasados
        function generateColdGames() {
            const coldNumbers = Object.keys(frequencyData)
                .filter(num => frequencyData[num] <= 3)
                .map(Number)
                .filter(num => !excludedNumbers.includes(num));
            
            if (coldNumbers.length === 0) {
                alert('Não há números atrasados disponíveis!');
                return;
            }
            
            // Seleciona 5-8 números frios aleatoriamente
            const coldToUse = coldNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(coldNumbers.length, Math.floor(Math.random() * 4) + 5));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...coldToUse])];
            initializeNumbers();
            generateGames();
        }

        // Gera jogos com números não sorteados
        function generateNotDrawnGames() {
            const availableNotDrawn = notDrawnNumbers.filter(num => !excludedNumbers.includes(num));
            
            if (availableNotDrawn.length === 0) {
                alert('Não há números não sorteados disponíveis!');
                return;
            }
            
            // Seleciona 3-5 números não sorteados
            const notDrawnToUse = availableNotDrawn
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(availableNotDrawn.length, Math.floor(Math.random() * 3) + 3));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...notDrawnToUse])];
            initializeNumbers();
            generateGames();
        }

        // Gera jogos com números do ciclo não sorteados
        function generateNotDrawnCycleGames() {
            if (!notDrawnCycleInfo.cycleActive || notDrawnCycleInfo.numbersNotDrawnInCycle.length === 0) {
                alert('O ciclo de números não sorteados não está ativo ou não há números disponíveis!');
                return;
            }
            
            const availableCycleNumbers = notDrawnCycleInfo.numbersNotDrawnInCycle.filter(num => !excludedNumbers.includes(num));
            
            if (availableCycleNumbers.length === 0) {
                alert('Todos os números do ciclo foram excluídos!');
                return;
            }
            
            // Seleciona 3-5 números do ciclo
            const cycleToUse = availableCycleNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(availableCycleNumbers.length, Math.floor(Math.random() * 3) + 3));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...cycleToUse])];
            initializeNumbers();
            generateGames();
        }

        // Gera jogos balanceados
        function generateBalancedGames() {
            const hotNumbers = Object.keys(frequencyData)
                .filter(num => frequencyData[num] >= 8)
                .map(Number)
                .filter(num => !excludedNumbers.includes(num));
            
            const coldNumbers = Object.keys(frequencyData)
                .filter(num => frequencyData[num] <= 3)
                .map(Number)
                .filter(num => !excludedNumbers.includes(num));
                
            // 8-10 números quentes
            const hotToUse = hotNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(hotNumbers.length, Math.floor(Math.random() * 3) + 8));
                
            // 5-7 números frios
            const coldToUse = coldNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(coldNumbers.length, Math.floor(Math.random() * 3) + 5));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...hotToUse, ...coldToUse])];
            initializeNumbers();
            generateGames();
        }

        // Gera jogos com todas as estratégias
        function generateGames() {
            if (document.getElementById('double-premium').checked) {
                generateDoublePremiumGames();
                return;
            }

            const gameCount = parseInt(document.getElementById('game-count').value) || 5;
            const gamesContainer = document.getElementById('generated-games');
            gamesContainer.innerHTML = '';

            for (let i = 0; i < gameCount; i++) {
                let numbers;
                let attempts = 0;
                
                do {
                    numbers = generateRandomNumbers(15 - fixedNumbers.length, [...fixedNumbers, ...excludedNumbers]);
                    numbers = [...fixedNumbers, ...numbers].sort((a, b) => a - b);
                    attempts++;
                    
                    if (attempts >= MAX_ATTEMPTS) {
                        alert('Não foi possível gerar jogos com os critérios atuais após ' + MAX_ATTEMPTS + ' tentativas!\n\nSugestão: Relaxe alguns filtros ou reduza a quantidade de números fixos.');
                        return;
                    }
                } while (
                    (document.getElementById('avoid-repeated').checked && isRepeatedCombination(numbers)) ||
                    (document.getElementById('balance-parity').checked && !isBalancedParity(numbers)) ||
                    (document.getElementById('use-primes').checked && !hasGoodPrimeCount(numbers)) ||
                    (document.getElementById('watch-extremes').checked && !hasGoodExtremes(numbers)) ||
                    (document.getElementById('use-not-drawn-cycle').checked && !usesNotDrawnCycleNumbers(numbers))
                );

                displayGame(numbers, i + 1);
            }
        }

        // Gera jogos para dobrar premiação (16-17 números)
        function generateDoublePremiumGames() {
            const gameCount = parseInt(document.getElementById('game-count').value) || 5;
            const gamesContainer = document.getElementById('generated-games');
            gamesContainer.innerHTML = '';

            for (let i = 0; i < gameCount; i++) {
                let numbers;
                let attempts = 0;
                const count = Math.random() > 0.5 ? 16 : 17;
                
                do {
                    numbers = generateRandomNumbers(count - fixedNumbers.length, [...fixedNumbers, ...excludedNumbers]);
                    numbers = [...fixedNumbers, ...numbers].sort((a, b) => a - b);
                    attempts++;
                    
                    if (attempts >= MAX_ATTEMPTS) {
                        alert('Não foi possível gerar jogos premium com os critérios atuais após ' + MAX_ATTEMPTS + ' tentativas!\n\nSugestão: Relaxe alguns filtros ou reduza a quantidade de números fixos.');
                        return;
                    }
                } while (
                    (document.getElementById('avoid-repeated').checked && isRepeatedCombination(numbers)) ||
                    (document.getElementById('balance-parity').checked && !isBalancedParity(numbers)) ||
                    (document.getElementById('use-primes').checked && !hasGoodPrimeCount(numbers)) ||
                    (document.getElementById('watch-extremes').checked && !hasGoodExtremes(numbers)) ||
                    (document.getElementById('use-not-drawn-cycle').checked && !usesNotDrawnCycleNumbers(numbers))
                );

                displayGame(numbers, i + 1);
            }
        }

        // Exibe um jogo gerado
        function displayGame(numbers, gameNumber) {
            const container = document.getElementById('generated-games');
            const gameElement = document.createElement('div');
            gameElement.className = 'game';
            
            const titleElement = document.createElement('div');
            titleElement.className = 'game-title';
            titleElement.textContent = `Jogo ${gameNumber} (${numbers.length} números)`;
            gameElement.appendChild(titleElement);
            
            const numbersElement = document.createElement('div');
            numbersElement.className = 'game-numbers';
            
            // Ordena os números para identificar extremos
            const sortedNumbers = [...numbers].sort((a, b) => a - b);
            const firstExtreme = sortedNumbers[0];
            const lastExtreme = sortedNumbers[sortedNumbers.length - 1];
            
            numbers.forEach(num => {
                const numElement = document.createElement('div');
                numElement.className = 'game-number';
                
                if (fixedNumbers.includes(num)) numElement.classList.add('fixed-number');
                if (notDrawnNumbers.includes(num)) numElement.classList.add('not-drawn-number');
                if (notDrawnLastNumbers.includes(num)) numElement.classList.add('not-drawn-last-number');
                if (PRIME_NUMBERS.includes(num)) numElement.classList.add('prime-number');
                if (num === firstExtreme || num === lastExtreme) numElement.classList.add('extreme-number');
                
                numElement.textContent = num;
                numbersElement.appendChild(numElement);
            });
            
            gameElement.appendChild(numbersElement);
            
            // Adiciona o relatório detalhado
            gameElement.appendChild(generateGameReport(numbers));
            container.appendChild(gameElement);
        }

        // Limpa seleções
        function clearSelections() {
            fixedNumbers = [];
            excludedNumbers = [];
            initializeNumbers();
            document.getElementById('generated-games').innerHTML = '';
        }

        // Salva os jogos gerados
        function saveGames() {
            const games = [];
            const gameElements = document.querySelectorAll('.game');
            
            gameElements.forEach(game => {
                const numbers = [];
                game.querySelectorAll('.game-number').forEach(num => {
                    numbers.push(parseInt(num.textContent));
                });
                games.push(numbers);
            });
            
            if (games.length === 0) {
                alert('Nenhum jogo para salvar!');
                return;
            }
            
            localStorage.setItem('savedGames', JSON.stringify({
                games: games,
                timestamp: new Date().toISOString(),
                strategies: {
                    avoidRepeated: document.getElementById('avoid-repeated').checked,
                    balanceParity: document.getElementById('balance-parity').checked,
                    usePrimes: document.getElementById('use-primes').checked,
                    doublePremium: document.getElementById('double-premium').checked,
                    watchExtremes: document.getElementById('watch-extremes').checked,
                    useNotDrawnCycle: document.getElementById('use-not-drawn-cycle').checked
                }
            }));
            
            alert(`${games.length} jogos salvos com sucesso!\n\nVocê pode fechar a página e os jogos permanecerão salvos.`);
        }

        // Carrega dados de fallback
        function loadFallbackData() {
            // Dados de exemplo para quando a API falha
            frequencyData = {
                1: 8, 2: 9, 3: 9, 4: 8, 5: 8,
                6: 7, 7: 8, 8: 9, 9: 8, 10: 9,
                11: 6, 12: 7, 13: 6, 14: 6, 15: 8,
                16: 3, 17: 5, 18: 3, 19: 4, 20: 5,
                21: 2, 22: 3, 23: 1, 24: 3, 25: 5
            };
            
            notDrawnNumbers = [16, 18, 21, 23];
            notDrawnLastNumbers = [3, 7, 16, 22, 25];
            notDrawnCycleInfo = {
                cycleActive: true,
                cycleStart: 2500,
                numbersNotDrawnInCycle: [3, 7, 16, 22, 25]
            };
            
            // Simula sorteios
            lastDraws = [];
            const baseNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
            
            for (let i = 0; i < 10; i++) {
                lastDraws.push({
                    numero: 2500 - i,
                    data: new Date(Date.now() - i * 3 * 24 * 60 * 60 * 1000).toLocaleDateString(),
                    dezenas: generateSimilarDraw(baseNumbers)
                });
            }
            
            calculateStatistics();
            updateDrawsDisplay();
            updateStatsTable();
            initializeNumbers();
            
            document.getElementById('last-results').style.display = 'block';
            document.getElementById('api-status').textContent = 'Usando dados de exemplo';
        }
    </script>
</body>
</html>
